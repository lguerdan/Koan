<html>
    <head> 
        <meta charset = "UTF-8"/>
        <meta name = "viewport" content = "width = device-width, initial-scale = 1">
        <title> Kōan </title>
        <link rel = "stylesheet" href = "koan.css"/>
        <script src = "jquery.js"></script>
    </head>

    <body> 
        <div id = "toolbar"> 
            <ul>
                <li id = "title"> Kōan </li>
                <li><a href = "#">Updates</a></li>
                <li><a href = "history.html">Historical Data</a></li>
                <li><a href = "index.html">Monitor</a></li>
            </ul>
        </div>

        <div id="container" style="width:100%; height:400px;"></div> 
        <script src="https://cdn.firebase.com/v0/firebase.js"></script> 
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script> 
        <script src="http://code.highcharts.com/highcharts.js"></script> 
        <script> 

        var alphaSeries = [];
        var betaSeries = []; 
        var deltaSeries = [];
        var gammaSeries = [];
        var thetaSeries = [];

        jQuery.ajax(
        {
            dataType: "json",
            url: "https://koan-cbd22.firebaseio.com/detailedprofiles.json",
            data: 'orderBy="timestamp"&limitToLast=50',
            success: function(data)
            {
                jQuery.each(data, function(name, val) 
                {
                    alphaSeries.push({ x: val.timestamp, y: val.alpha });
                    betaSeries.push({ x: val.timestamp, y: val.beta });
                });
            }
        });

        Highcharts.setOptions(
        {
            global: {
                useUTC: false
            }
        });

        $('#container').highcharts(
        {
            chart: 
            {
                type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: 
                {
                    load: function () 
                    {
                        var aseries = this.series[0];
                        var bseries = this.series[1];
                        var dseries = this.series[2];
                        var gseries = this.series[3];
                        var tseries = this.series[4];
                        // set up the updating of the chart each second
                        
                        setInterval(function () 
                        {
                            // var x = (new Date()).getTime(), // current time
                            //     y = Math.random();
                            // series.addPoint([x, y], true, true);
                            jQuery.ajax(
                            {
                                dataType: "json",
                                url: "https://koan-cbd22.firebaseio.com/detailedprofiles.json",
                                data: 'orderBy="timestamp"&limitToLast=1',
                                success: function(data)
                                {
                                    jQuery.each(data, function(name, val) 
                                    {
                                        aseries.addPoint([val.timestamp, val.alpha], true, false);
                                        bseries.addPoint([val.timestamp, val.beta], true, false);
                                        dseries.addPoint([val.timestamp, val.delta], true, false);
                                        gseries.addPoint([val.timestamp, val.gamma], true, false);
                                        tseries.addPoint([val.timestamp, val.theta], true, false);
                                        //series.addPoint([val.timestamp, val.alpha], true, false);
                                    });
                                }
                            });
                        }, 1000);
                    }
                }
            },

            title: {
                text: 'Live EEG Waves'
            },

            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },

            yAxis: 
            {
                title: {
                    text: 'Value'
                },

                plotLines: [
                {
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },

            tooltip: 
            {
                formatter: function () 
                {
                    return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                        Highcharts.numberFormat(this.y, 2);
                }
            },

            legend: {
                enabled: true
            },

            exporting: {
                enabled: false
            },

            series: [
            {
                name: 'Alpha',
                data: alphaSeries
            },

            {
                name: 'Beta',
                data: betaSeries
            },

            {
                name: 'Delta',
                data: deltaSeries
            },

            {
                name: 'Gamma',
                data: gammaSeries
            },

            {
                name: 'Theta',
                data: thetaSeries
            }]
        });
                  
</script>
